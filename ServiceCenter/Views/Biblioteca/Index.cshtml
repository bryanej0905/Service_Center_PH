@model IEnumerable<ServiceCenter.Models.Guia>

@{
    ViewBag.Title = "Biblioteca Didáctica";
}

<div class="faq-container">
    <!-- Título principal -->
    <!-- Título principal -->
    <h2 class="text-white mt-5 mb-4">Biblioteca Didáctica</h2>

    <!-- Formulario de búsqueda -->
    @using (Html.BeginForm("Index", "Biblioteca", FormMethod.Get))
    {
        <div class="input-group mb-4" style="max-width: 400px;">
            <input type="text"
                   name="searchString"
                   value="@(ViewBag.CurrentFilter ?? "")"
                   class="form-control"
                   placeholder="Ingrese palabras clave…" />
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Buscar
            </button>
        </div>
    }

    <!-- Si no hay resultados, mostrar una alerta -->
    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-warning">
            No se encontraron resultados. Prueba con otro término.
        </div>
    }
    else
    {
        <!-- Accordion que lista cada guía junto a su categoría y un botón a Details -->
        <div class="accordion" id="bibliotecaAccordion">
            @foreach (var elemento in Model.Select((g, i) => new { G = g, Index = i }))
            {
                var guia = elemento.G;
                var headingId = $"heading{elemento.Index}";
                var collapseId = $"collapse{elemento.Index}";

                <div class="accordion-item mb-2">

                    <!-- 1) HEADER que controla el collapse -->
                    <h2 class="accordion-header" id="@headingId">
                        <button class="accordion-button collapsed faq-question"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#@collapseId"
                                aria-expanded="false"
                                aria-controls="@collapseId">
                            <i class="fas fa-book-reader me-2"></i>
                            @guia.Titulo
                            <small class="text-secondary ms-3">
                                @(guia.Categoria?.Nombre ?? "Sin Categoría")
                            </small>
                        </button>
                    </h2>

                    <!-- 2) PANEL (colapsable) -->
                    <div id="@collapseId"
                         class="accordion-collapse collapse"
                         aria-labelledby="@headingId"
                         data-bs-parent="#bibliotecaAccordion">
                        <div class="accordion-body faq-answer">
                            @{
                                // Mostrar un resumen de hasta 150 caracteres
                                var resumen = guia.Contenido.Length > 150
                                    ? guia.Contenido.Substring(0, 150) + "…"
                                    : guia.Contenido;
                            }
                            <p>@Html.Raw(resumen.Replace("\r\n", "<br/>").Replace("\n", "<br/>"))</p>

                            <a href="@Url.Action("Details", "Biblioteca", new { id = guia.Id })"
                               class="btn btn-link">
                                Ver detalle completo
                            </a>
                        </div>
                    </div>

                </div>
            }
        </div>
    }
</div>

@section Styles {
    <style>
        /* Estilos para que el acordeón se vea bien sobre fondo oscuro */
        .faq-question {
            background-color: rgba(0, 0, 0, 0.6);
            color: #ffffff;
            border: none;
        }

            .faq-question:not(.collapsed) {
                background-color: rgba(0, 0, 0, 0.8);
                color: #ffffff;
            }

            .faq-question::after {
                filter: invert(1); /* Hace blanca la flecha del acordeón */
            }

        .faq-answer {
            background-color: rgba(0, 0, 0, 0.5);
            color: #ffffff;
        }

        .accordion-item {
            border: none;
        }

            .accordion-item + .accordion-item {
                margin-top: 0.5rem;
            }
    </style>
}
