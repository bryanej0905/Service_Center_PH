@model IEnumerable<ServiceCenter.Models.Guia>
@{
    ViewBag.Title = "Biblioteca Didáctica";
}

@section Styles {
    <style>
        h1 {
            font-size: 2.5rem;
            font-weight: 600;
        }

        .accordion-button {
            background-color: rgba(40, 40, 40, 0.8);
            color: #ffffff;
        }

            .accordion-button:not(.collapsed) {
                background-color: rgba(30, 30, 30, 0.9);
                color: #ffffff;
            }

            .accordion-button::after {
                filter: invert(1);
            }

        .accordion-body {
            background-color: rgba(50, 50, 50, 0.6);
            color: #eee;
        }

        .accordion-item {
            border: none;
        }

            .accordion-item + .accordion-item {
                margin-top: 0.5rem;
            }

        .list-group-item.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .list-group-item a {
            display: block;
        }
    </style>
}

<div class="container my-4">
    <div class="row">
        <!-- Columna principal ocupa todo el ancho -->
        <div class="col-md-12">
            <h1 class="mb-4 text-white">Todas las Guías</h1>
            <form class="input-group mb-3" method="get" action="@Url.Action("Index", "Biblioteca")">
                <input type="text" name="searchString" class="form-control" placeholder="Buscar por palabra clave..." value="@(ViewBag.CurrentFilter ?? "")" />
                <button class="btn btn-primary" type="submit"><i class="fas fa-search"></i> Buscar</button>
            </form>
            <div class="accordion" id="bibliotecaAccordion">
                @foreach (var item in Model.Select((g, i) => new { G = g, Idx = i }))
                {
                    var heading = $"heading{item.Idx}";
                    var collapse = $"collapse{item.Idx}";
                    <div class="accordion-item mb-2">
                        <h2 class="accordion-header" id="@heading">
                            <button class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@collapse"
                                    aria-expanded="false"
                                    aria-controls="@collapse">
                                <i class="fas fa-book me-2"></i>
                                @item.G.Titulo
                                <small class="text-secondary ms-3">
                                    @(item.G.Categoria?.Nombre ?? "Sin Categoría")
                                </small>
                            </button>
                        </h2>
                        <div id="@collapse"
                             class="accordion-collapse collapse"
                             aria-labelledby="@heading"
                             data-bs-parent="#bibliotecaAccordion">
                            <div class="accordion-body">
                                @{
                                    var texto = item.G.Contenido ?? "";
                                    var resumen = texto.Length > 200 ? texto.Substring(0, 200) + "…" : texto;
                                }
                                <div class="mb-2">@Html.Raw(resumen.Replace("\r\n", "<br/>"))</div>
                                <a href="@Url.Action("Details", "Biblioteca", new { id = item.G.Id })" class="btn btn-primary btn-sm me-2">Ver detalles</a>
                                <a href="@Url.Action("DescargarPDF", "Biblioteca", new { id = item.G.Id })" class="btn btn-danger btn-sm">Descargar PDF</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>