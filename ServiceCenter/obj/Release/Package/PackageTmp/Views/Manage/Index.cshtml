@model ServiceCenter.Models.IndexViewModel
@using Microsoft.AspNet.Identity
@using System.Security.Claims
@{
    ViewBag.Title = "Mi Perfil";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<main class="container py-5">
    <div class="card shadow-lg rounded-3 overflow-hidden">
        <!-- Header -->
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">
                <i class="fas fa-user-circle me-2"></i> Mi Perfil
            </h2>
        </div>

        <div class="card-body">
            <div class="row gx-5">
                <!-- FOTO + FORMULARIO SUBIDA -->
                <div class="col-md-4 text-center mb-4 mb-md-0">
                    <img src="@Model.PhotoUrl"
                         alt="Avatar"
                         class="rounded-circle border border-3 border-white shadow-sm mb-3"
                         style="width:180px; height:180px; object-fit:cover;" />

                    <!-- Formulario para cambiar foto -->
                    @using (Html.BeginForm("UploadPhoto", "Manage", FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        <div class="input-group">
                            <input type="file"
                                   name="photo"
                                   class="form-control"
                                   accept="image/*" />
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                    }

                    <h4 class="mt-3 text-primary">@Model.UserName</h4>
                    <p class="text-muted mb-0">@Model.Email</p>
                </div>

                <!-- DATOS DETALLADOS -->
                <div class="col-md-8">
                    <dl class="row">
                        <dt class="col-sm-4">Usuario</dt>
                        <dd class="col-sm-8">@Model.UserName</dd>
                        <dt class="col-sm-4">Nombre completo</dt>
                        <dd class="col-sm-8">@Model.Nombre</dd>
                        <dt class="col-sm-4">Correo</dt>
                        <dd class="col-sm-8">@Model.Email</dd>

                        @*<dt class="col-sm-4">Teléfono</dt>
                    <dd class="col-sm-8">
                        @if (Model.PhoneNumberConfirmed)
                        {
                            @Model.PhoneNumber
                        }
                        else
                        {
                            <span class="text-muted">No confirmado</span>
                        }
                    </dd>*@

                        @*<dt class="col-sm-4">2FA habilitado</dt>
                    <dd class="col-sm-8">@Model.TwoFactorEnabled</dd>*@

                        <dt class="col-sm-4">Bloqueo activado</dt>
                        <dd class="col-sm-8">@Model.LockoutEnabled</dd>

                        <dt class="col-sm-4">Fin de bloqueo</dt>
                        <dd class="col-sm-8">
                            @(
        Model.LockoutEndDateUtc?.ToString("dd/MM/yyyy HH:mm")
        ?? "-"
    )
                        </dd>


                        <dt class="col-sm-4">Intentos fallidos</dt>
                        <dd class="col-sm-8">@Model.AccessFailedCount</dd>

                        <dt class="col-sm-4">Registrado desde</dt>
                        <dd class="col-sm-8">@Model.FechaCreacion.ToString("dd/MM/yyyy")</dd>

                        <dt class="col-sm-4">Roles</dt>
                        <dd class="col-sm-8">@Model.RolesDisplay</dd>
                    </dl>
                </div>
            </div>

            <hr />

            @if (!String.IsNullOrEmpty(Model.StatusMessage))
            {
                <div class="alert alert-success text-center">
                    @Model.StatusMessage
                </div>
            }

            <!-- ACCIONES -->
            <div class="row gy-3 mt-4 justify-content-center">
                <!-- Cambiar contraseña via GET -->
                <div class="col-md-4">
                    @using (Html.BeginForm("ChangePassword", "Account", FormMethod.Get, new { @class = "w-100" }))
                    {
                        <button type="submit" class="btn btn-outline-primary w-100">
                            <i class="fas fa-key me-1"></i> Cambiar contraseña
                        </button>
                    }
                </div>

                <!-- Cerrar sesión via POST -->
                <div class="col-md-4">
                    @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { @class = "w-100" }))
                    {
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-outline-danger w-100">
                            <i class="fas fa-sign-out-alt me-1"></i> Cerrar sesión
                        </button>
                    }
                </div>
            </div>



        </div>
    </div>
</main>

<style>
  

    .card {
        border: none;
    }

    .input-group input[type="file"] {
        padding: 0.25rem 0.5rem;
    }
</style>
